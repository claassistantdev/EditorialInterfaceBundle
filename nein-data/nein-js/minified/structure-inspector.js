YUI.add("ez-structure-inspector",function(e){"use strict";function n(e){n.superclass.constructor.apply(this,arguments)}e.namespace("eZ");var t=e.Lang;n.NAME="structure-inspector",n.CSS_PREFIX="ez-ei-"+n.NAME,n.ATTRS={callerID:{value:""}},n.HTML_PARSER={},e.extend(n,e.Widget,{initializer:function(){this.sourceNode=this.get("srcNode"),this._createNodes(),this._syncNodes(e.one(null)),this.pageNode.delegate("click",this._pageClick,"li"),this.treeNode.delegate("click",this._elementClick,"li")},destructor:function(){},renderUI:function(){},bindUI:function(){},syncUI:function(){},update:function(e){this._syncNodes(e)},_createNodes:function(){var t=n.CSS_PREFIX;this.headerNode=e.Node.create(['<div class="',t,"-header",'" ></div>'].join("")),this.treeViewNode=e.Node.create(['<div class="',t,"-tree-view",'" ></div>'].join("")),this.pageWrapperNode=e.Node.create("<ul></ul>"),this.pageNode=e.Node.create(['<li class="',t,"-page",'" ><a href="#page">Page</a></li>'].join("")),this.treeNode=e.Node.create(['<ul class="',t,"-tree",'" ></ul>'].join("")),this.pageWrapperNode.appendChild(this.pageNode),this.treeViewNode.appendChild(this.pageWrapperNode),this.treeViewNode.appendChild(this.treeNode),this.sourceNode.appendChild(this.headerNode),this.sourceNode.appendChild(this.treeViewNode)},_syncNodes:function(t){this.headerNode.setHTML(document.title),this.treeNode.empty(),this.pageNode.removeClass("selected"),this._syncRootNodes();if(t){var n=new Array,r=t,i=e.one("#"+r.getAttribute("data-ez-editable-region-parent")),s=this,o=40;while(i)n.push(i),r=i,i=e.one("#"+r.getAttribute("data-ez-editable-region-parent"));if(n){r=n.pop();while(r){o+=20;var u=e.Node.create("<ul></ul>"),a=e.one("li[data-ez-editable-region-rel="+r.getAttribute("id")+"]"),f=e.all("#"+r.getAttribute("id")+" [data-ez-editable-region-level="+(parseInt(r.getAttribute("data-ez-editable-region-level"),10)+1)+"]");f.each(function(e,t){var n=s._createListItemFromNode(e);n.setStyle("paddingLeft",o),n.setStyle("backgroundPosition",o-20+"px 8px"),u.appendChild(n),a.insert(u,"after")}),r=n.pop()}}var l=e.one("li[data-ez-editable-region-rel="+t.getAttribute("id")+"]");l.addClass("selected");if(l.hasClass("items-container")){o+=20,f=e.all("#"+t.getAttribute("id")+" [data-ez-editable-region-level="+(parseInt(t.getAttribute("data-ez-editable-region-level"),10)+1)+"]");var u=e.Node.create("<ul></ul>");f.each(function(e,t){var n=s._createListItemFromNode(e);n.setStyle("paddingLeft",o),n.setStyle("backgroundPosition",o-20+"px 8px"),n.addClass("editable"),u.appendChild(n),l.insert(u,"after")})}}else{var c=this.treeNode.get("children");c.addClass("editable"),this.pageNode.addClass("selected")}},_syncRootNodes:function(){var t=e.all('[data-ez-editable-region="true"][data-ez-editable-region-level=1]'),n=this;t.isEmpty()||t.each(function(e,t){e.hasAttribute("data-ez-editable-region-marker")||e.setAttribute("data-ez-editable-region-marker",t+1);var r=n._createListItemFromNode(e);n.treeNode.appendChild(r)})},_createListItemFromNode:function(t){var n=e.Node.create(['<li data-ez-editable-region-rel="',t.getAttribute("id"),'">','<a href="#inspect" rel="',t.getAttribute("id"),'">',t.getAttribute("data-ez-editable-region-marker")," <span>",t.getAttribute("data-ez-field-identifier"),"</span>","</a>","</li>"].join(""));if(!t.hasAttribute("data-ez-field-type-identifier"))n.addClass("items-container");else switch(t.getAttribute("data-ez-field-type-identifier")){case"ezstring":n.addClass("item-text");break;case"eztext":n.addClass("item-text");break;case"ezimage":n.addClass("item-image");break;case"ezsomethingorother":n.addClass("item-invisible")}return n},_pageClick:function(t){t.preventDefault(),e.fire("structureInspector:pageClicked")},_elementClick:function(t){t.preventDefault(),e.fire("overlay:overlayClicked",{},e.one("#"+this.getAttribute("data-ez-editable-region-rel")))}}),e.eZ.StructureInspector=n},"0.1alpha",["widget","node"]);