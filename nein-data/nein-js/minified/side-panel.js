// TODO: case of 2 panels
// TODO: strange behaviour in FE mode
YUI.add("ez-side-panel",function(e){"use strict";function n(e){n.superclass.constructor.apply(this,arguments)}e.namespace("eZ");var t=e.Lang;n.NAME="side-panel",n.CSS_PREFIX="ez-ei-"+n.NAME,n.ATTRS={triggerClassName:{value:"-trigger"},contentClassName:{value:"-content"},separatorClassName:{value:"-drag-separator"},sideMargin:{value:10},minWidth:{value:20},openingWidth:{value:300},mode:{value:"left"}},n.HTML_PARSER={},e.extend(n,e.Widget,{initializer:function(){this.eventClicked=!1,this.eventDragged=!1,this.sideMargin=this.get("sideMargin"),this.minWidth=this.get("minWidth"),this.sourceNode=this.get("srcNode"),this.htmlNode=e.one("html.ezp-user-logged-in"),this.separatorNode=e.one("#"+this.sourceNode.generateID()+" ."+n.CSS_PREFIX+this.get("separatorClassName")),this.mode=this.get("mode"),this.contentNode=e.one("#"+this.sourceNode.generateID()+" ."+n.CSS_PREFIX+this.get("contentClassName")),this.contentNode.hide(),this.triggerNode=e.one("#"+this.sourceNode.generateID()+" ."+n.CSS_PREFIX+this.get("triggerClassName")),this.triggerNode.on("mousedown",this._onMouseDown,this),this.separatorNode.on("mousedown",this._onMouseDown,this),this._syncNodes()},destructor:function(){},renderUI:function(){},bindUI:function(){},syncUI:function(){},appear:function(){this.mode=="left"?(this.sourceNode.setStyle("left",-25),this.sourceNode.setStyle("visibility","visible"),this.sourceNode.transition({left:{delay:.5,duration:.5,value:0}}),this.sourceNode.setStyle("left",0)):(this.sourceNode.setStyle("right",-25),this.sourceNode.setStyle("visibility","visible"),this.sourceNode.transition({right:{delay:.5,duration:.5,value:0}}),this.sourceNode.setStyle("right",0)),this._syncNodes()},disappear:function(){this.move(-parseInt(this.sourceNode.getComputedStyle("width"),10)),this.sourceNode.setStyle("visibility","hidden")},move:function(t){var n=parseInt(this.sourceNode.getComputedStyle("width"),10),r=n+t;r<this.minWidth&&(this.hideContent(),r=this.minWidth),r>this.minWidth&&!this.contentNode.hasClass("opened")&&this.showContent(),this.mode=="left"?this.htmlNode.setStyles({marginLeft:r+this.sideMargin}):this.htmlNode.setStyles({marginRight:r+this.sideMargin}),this.sourceNode.setStyles({width:r}),this._syncNodes(),e.fire("sidePanel:move")},showContent:function(){this.contentNode.show(),this.contentNode.setStyles({display:"block"}),this.contentNode.addClass("opened"),this.sourceNode.addClass("opened")},hideContent:function(){this.contentNode.hide(),this.contentNode.removeClass("opened"),this.sourceNode.removeClass("opened")},syncPanel:function(){this._syncNodes()},_syncNodes:function(){var e,t;this.mode=="left"?(e=this.sourceNode.getX()+parseInt(this.sourceNode.getComputedStyle("width"),10)-parseInt(this.triggerNode.getComputedStyle("width"),10),t=this.sourceNode.getX()+parseInt(this.sourceNode.getComputedStyle("width"),10)):(e=this.sourceNode.getX(),t=this.sourceNode.getX()-parseInt(this.separatorNode.getComputedStyle("width"),10)),this.triggerNode.setXY([e,this.sourceNode.getY()+(parseInt(this.sourceNode.getComputedStyle("height"),10)-parseInt(this.triggerNode.getComputedStyle("height"),10))/2]),this.separatorNode.setXY([t,this.sourceNode.getY()])},_onMouseDown:function(e){e.preventDefault(),this.eventClicked=!0,e._event.pageX?this.pageX=e._event.pageX:this.pageX=e._event.clientX,this.htmlNode.on("mousemove",this._panelDrag,this),this.htmlNode.on("mouseup",this._onMouseUp,this),this.htmlNode.on("mouseleave",this._onMouseUp,this)},_onMouseUp:function(e){this.eventClicked=!1,this.eventDragged?this.eventDragged=!1:e.target==this.triggerNode&&(this.contentNode.hasClass("opened")?(this.move(-parseInt(this.sourceNode.getComputedStyle("width"),10)),this.hideContent()):(this.showContent(),this.move(this.get("openingWidth")))),this.htmlNode.detach("mousemove",this._panelDrag),this.htmlNode.detach("mouseup",this._triggerMouseUp),this.htmlNode.detach("mouseleave",this._triggerMouseUp)},_panelDrag:function(e){if(this.eventClicked){this.eventDragged=!0;var t=0;e._event.pageX?t=e._event.pageX:t=e._event.clientX;var n=t-this.pageX;this.pageX=t,this.mode=="right"&&(n=-n),this.move(n)}},_onMouseLeave:function(e){this.eventClicked=!1,this.eventDragged=!1,this.htmlNode.detach("mousemove",this._panelDrag),this.htmlNode.detach("mouseup",this._triggerMouseUp),this.htmlNode.detach("mouseleave",this._triggerMouseUp)}}),e.eZ.SidePanel=n},"0.1alpha",["widget"]);