// TODO: GLOBAL - apply sprite approach, when all resources will be set.
YUI.add("ez-editorial-interface",function(e){"use strict";function r(e){r.superclass.constructor.apply(this,arguments),this.CONTENT_TEMPLATE=null,this._operationSwitcher=null,this._deviceSelector=null,this._targetingOverlay=null,this._focusedOverlay=null,this._formEditor=null,this._leftSidePanel=null,this._rightSidePanel=null,this._structureInspector=null,this._assetsManager=null}e.namespace("eZ");var t=e.Lang,n=e.one("body");r.NAME="editorialInterface",r.CSS_PREFIX="ez-ei",r.ATTRS={mobileBreakPoint:{value:960,validator:t.isNumber,writeOnce:!0},dependencies:{value:{operationSwitcherMobile:{constructor:e.eZ.SwitchesSlider,config:{srcNode:".ez-ei-operational-mode-switch"}},operationSwitcher:{constructor:e.eZ.Switches,config:{srcNode:".ez-ei-operational-mode-switch"}},deviceDropdown:{constructor:e.eZ.Dropdown,config:{srcNode:".ez-ei-device-selector"}},targetingOverlay:{constructor:e.eZ.Overlay,config:{srcNode:".ez-ei-content-wrapper"}},focusedOverlay:{constructor:e.eZ.FocusedOverlay,config:{srcNode:".ez-ei-content-inner-wrapper"}},FOlanguageDropdown:{constructor:e.eZ.Dropdown,config:{srcNode:".ez-ei-focused-overlay-language-selector"}},FOversionDropdown:{constructor:e.eZ.Dropdown,config:{srcNode:"#ez-ei-focused-overlay-version-selector"}},formEditor:{constructor:e.eZ.FormEditor,config:{srcNode:".ez-ei-working-bench"}},FElanguageDropdown:{constructor:e.eZ.Dropdown,config:{srcNode:".ez-ei-form-editor-language-selector"}},FEversionDropdown:{constructor:e.eZ.Dropdown,config:{srcNode:"#ez-ei-form-editor-version-selector"}},leftSidePanel:{constructor:e.eZ.SidePanel,config:{srcNode:"#ez-ei-side-panel-left"}},rightSidePanel:{constructor:e.eZ.SidePanel,config:{srcNode:"#ez-ei-side-panel-right",mode:"right"}},structureInspector:{constructor:e.eZ.StructureInspector,config:{srcNode:"#ez-ei-structure-inspector"}},assetsManager:{constructor:e.eZ.AssetsManager,config:{srcNode:"#ez-ei-side-panel-right"}}},setter:function(t){return e.merge(r.ATTRS.dependencies.value,t)},writeOnce:!0}},r.HTML_PARSER={},e.extend(r,e.Widget,{initializer:function(){var t=this;e.Get.css("nein-data/nein-css/nein-reset.css"),e.Get.css("nein-data/nein-css/nein-composition.css",function(){t.appear()});var r=n.get("children"),t=this;this.workingBench=e.Node.create('<div class="ez-ei-working-bench"></div>'),this.ruler=e.Node.create('<div class="ez-ei-linear"></div>'),this.contentWrapper=e.Node.create('<div class="ez-ei-content-wrapper"></div>'),this.contentInnerWrapper=e.Node.create('<div class="ez-ei-content-inner-wrapper"></div>'),this.contentWrapper.appendChild(this.contentInnerWrapper),this.workingBench.appendChild(this.ruler),this.workingBench.appendChild(this.contentWrapper),n.appendChild(this.workingBench),r.each(function(e,n){e.hasClass("ezp-nein")||(e.remove(!1),t.contentInnerWrapper.appendChild(e))});var i=e.one("#ezp-nein-header").getHTML(),s=e.Handlebars.compile(i),o=e.one("#ezp-nein-left-aside").getHTML(),u=e.Handlebars.compile(o),a=e.one("#ezp-nein-right-aside").getHTML(),f=e.Handlebars.compile(a);n.appendChild(s({})),n.append(u({})),n.append(f({dialogButtons:[{action:"cancel",label:"Cancel"},{action:"upload",label:"Upload"}]}))},destructor:function(){this._operationSwitcher=null,this._deviceSelector=null,this._targetingOverlay=null,this._focusedOverlay=null,this._FOlanguageDropdown=null,this._FOversionDropdown=null},renderUI:function(){this._operationSwitcher=this._getInstance("operationSwitcher"),this._deviceSelector=this._getInstance("deviceDropdown"),this._targetingOverlay=this._getInstance("targetingOverlay"),this._focusedOverlay=this._getInstance("focusedOverlay"),this._formEditor=this._getInstance("formEditor"),this._leftSidePanel=this._getInstance("leftSidePanel"),this._rightSidePanel=this._getInstance("rightSidePanel"),this._structureInspector=this._getInstance("structureInspector"),this._assetsManager=this._getInstance("assetsManager"),this._prepareFeatures()},bindUI:function(){var n=this;this._deviceSelector.on("updateTrigger",function(e){var r=this.get("selectedValueNode"),i=this.get("selected"),s=i.getAttribute("data-value");t.isObject(r)&&t.isObject(i)&&(e.preventDefault(),r.setAttribute("data-icon",s)),s!="O"&&n._notImplementedLinkClick(e)});var n=this;this._operationSwitcher.on("switch",function(e){console.log("Switched from",e.prevVal,"to",e.newVal),e.newVal=="edit"?(n._targetingOverlay.showOverlays(1,""),n._leftSidePanel.appear(),n._rightSidePanel.appear(),n._assetsManager.update()):(n._leftSidePanel.disappear(),n._rightSidePanel.disappear(),n._targetingOverlay.hideOverlays(),n._focusedOverlay.hideFocusedOverlay())}),e.one(".ez-ei-header").delegate("click",this._logoutLinkClick,".ez-ei-logout",this),e.one(".ez-ei-header-main-navigation").delegate("click",this._notImplementedLinkClick,"ul li:not([class]) a"),e.on("windowresize",e.bind("_prepareFeatures",this)),e.on("overlay:overlayClicked",this._dispatchTargetOverlayClick,this),e.on("focusedOverlay:close",this._dispatchFocusedOverlayClose,this),e.on("focusedOverlay:onCreate",this._dispatchFocusedOverlayOnCreate,this),e.on("focusedOverlay:editLinkClicked",this._dispatchFocusedOverlayEditLinkClicked,this),e.on("formEditor:onCreate",this._dispatchFormEditorOnCreate,this),e.on("formEditor:close",this._dispatchFormEditorClose,this),e.on("formEditor:overlayClicked",this._dispatchFormEditorOverlayClicked,this),e.on("formEditor:topNavigationReturn",this._dispatchFormEditorTopNavigationReturn,this),e.on("sidePanel:move",this._dispatchSidePanelMove,this),e.on("structureInspector:pageClicked",this._dispatchStructureInspectorPageClick,this)},syncUI:function(){this._operationSwitcher.render(),this._deviceSelector.render()},appear:function(){var t=e.one(".ez-ei-header"),n=e.one("html.ezp-user-logged-in"),r=t.get("offsetHeight"),i=this;t.setStyle("marginTop",-r),n.setStyle("marginTop",0),t.transition({marginTop:{duration:.8,value:0}}),n.transition({marginTop:{duration:.8,value:r+"px"},marginLeft:{duration:.8,value:"30px"}},function(){i._setContentWrapper()})},_setContentWrapper:function(){if(!e.one('link[href="nein-data/nein-css/nein-composition.css"]'))return!1;var t=e.one(".ez-ei-header");t.setStyles({marginTop:0}),e.one("html.ezp-user-logged-in").setStyles({marginTop:parseInt(t.getComputedStyle("height"),10)+10});var n=e.one(".ez-ei-working-bench"),r=e.one(".ez-ei-content-wrapper"),i=e.one(".ez-ei-content-inner-wrapper"),s=parseInt(n.getStyle("paddingTop"),10),o=parseInt(n.getStyle("paddingBottom"),10),u=parseInt(e.one("html").getStyle("marginTop"),10)+parseInt(e.one("html").getStyle("marginBottom"),10),a=s+o,f=this._getWinHeight()-u-a;this._centralizeModeSwitch(),this._formEditor.syncFormEditor(),i.setStyles({minWidth:0}),n.setStyles({height:f});var l=e.one("#ez-ei-side-panel-left");l.setStyles({marginLeft:0,marginTop:parseInt(t.getComputedStyle("height"),10)+10,height:f+20});var c=e.one("#ez-ei-side-panel-right");c.setStyles({marginLeft:0,marginTop:parseInt(t.getComputedStyle("height"),10)+10,height:f+20}),i.setStyles({minWidth:parseInt(r.get("scrollWidth"),10)}),r.setStyles({height:f,width:parseInt(n.getStyle("width"),10)})},_prepareFeatures:function(){this._useMobileLayout()?this._prepareMobileFeatures():this._setContentWrapper(),this._targetingOverlay.syncOverlays(),this._focusedOverlay.syncFocusedOverlay(),this._formEditor.syncFormEditor(),this._leftSidePanel.syncPanel(),this._rightSidePanel.syncPanel()},_prepareMobileFeatures:function(){var t=e.one("header.ez-ei-header"),n=e.one(".ez-ei-operational-mode-switch"),r=parseInt(t.getStyle("height"));e.on("scroll",e.bind("_handleScroll",this,n,r));var i=e.one("html.ezp-user-logged-in"),s=e.one(".ez-ei-header");i.setStyles({marginTop:parseInt(s.getComputedStyle("height"),10)+10}),s.setStyles({marginTop:-parseInt(s.getComputedStyle("height"),10)-10});var o=e.one(".ez-ei-content-inner-wrapper"),u=e.one(".ez-ei-content-wrapper");o.setStyles({minWidth:0}),u.setStyles({width:"auto"})},_centralizeModeSwitch:function(){var t=e.one(".ez-ei-switch-container"),n=e.all(".ez-ei-header-main-navigation > ul > li, .ez-ei-free-drop-down"),r=0,i=parseInt(t.getComputedStyle("width"),10),s=t.get("parentNode").get("offsetWidth");n.each(function(e){r+=this.get("offsetWidth")});var o=s-r,u=o/2-i;t.setStyle("paddingLeft",u+"px")},_handleScroll:function(e,t){e.get("docScrollY")>t?e.addClass("ez-ei-fixed"):e.removeClass("ez-ei-fixed")},_getInstance:function(e){var n=this.get("dependencies."+e);return!t.isObject(n)||!t.isFunction(n.constructor)?null:new n.constructor(t.isObject(n.config)?n.config:{})},_useMobileLayout:function(){return this._getWinWidth()<this.get("mobileBreakPoint")},_getWinWidth:function(){return n.get("winWidth")},_getWinHeight:function(){return n.get("winHeight")},_logoutLinkClick:function(t){t.preventDefault(),e.one("html.ezp-user-logged-in").transition({margin:{delay:.2,duration:.6,value:"0px"}}),e.one('link[href="nein-data/nein-css/nein-reset.css"]').remove("true"),e.one('link[href="nein-data/nein-css/nein-composition.css"]').remove("true"),e.one("#ez-ei-side-panel-left").remove(!0),e.one("#ez-ei-side-panel-right").remove(!0),e.one(".ez-ei-header").remove(!0);var r=this.contentInnerWrapper.get("children");r.each(function(e){e.hasClass("ez-ei-focused-overlay")||n.append(e)}),this.workingBench.remove(!0)},_notImplementedLinkClick:function(e){e&&e.preventDefault(),alert("Not implemented yet!")},_dispatchTargetOverlayClick:function(e,t){this._focusedOverlay.hideFocusedOverlay(),t.hasAttribute("data-ez-field-type-identifier")?(this._targetingOverlay.showOverlays(),this._formEditor.showFormEditor(t)):(this._focusedOverlay.showFocusedOverlay(t),this._targetingOverlay.showOverlays(parseInt(t.getAttribute("data-ez-editable-region-level"),10)+1,t.getAttribute("id"),t.getAttribute("data-ez-editable-region-marker")),this._formEditor.flagVisible&&this._formEditor.showFormEditor(t)),this._structureInspector.update(t)},_dispatchFocusedOverlayClose:function(e){this._focusedOverlay.hideFocusedOverlay(),this._targetingOverlay.showOverlays(),this._structureInspector.update(null)},_dispatchFocusedOverlayOnCreate:function(e){var t=this;this._FOlanguageDropdown=this._getInstance("FOlanguageDropdown"),this._FOversionDropdown=this._getInstance("FOversionDropdown"),this._FOlanguageDropdown.render(),this._FOversionDropdown.render(),this._FOlanguageDropdown.on("change",function(e){console.log("FO Language selector change from",e.prevVal.getContent(),"to",e.newVal.getContent()),t._notImplementedLinkClick(null)}),this._FOversionDropdown.on("change",function(e){t._notImplementedLinkClick(null)})},_dispatchFormEditorOnCreate:function(e){this._FElanguageDropdown=this._getInstance("FElanguageDropdown"),this._FEversionDropdown=this._getInstance("FEversionDropdown"),this._FElanguageDropdown.render(),this._FEversionDropdown.render(),this._FElanguageDropdown.on("change",function(e){console.log("FE Language selector change from",e.prevVal.getContent(),"to",e.newVal.getContent())})},_dispatchFocusedOverlayEditLinkClicked:function(e,t){this._focusedOverlay.hideFocusedOverlay(),this._targetingOverlay.showOverlays(),this._formEditor.showFormEditor(t)},_dispatchFormEditorClose:function(e){this._formEditor.hideFormEditor(),this._focusedOverlay.hideFocusedOverlay(),this._targetingOverlay.showOverlays(),this._structureInspector.update(null)},_dispatchFormEditorOverlayClicked:function(e,t){this._formEditor.showFormEditor(t),this._structureInspector.update(t)},_dispatchFormEditorTopNavigationReturn:function(e,t){this._formEditor.hideFormEditor(),this._setContentWrapper(),this._focusedOverlay.showFocusedOverlay(t),this._targetingOverlay.showOverlays(parseInt(t.getAttribute("data-ez-editable-region-level"),10)+1,t.getAttribute("id"),t.getAttribute("data-ez-editable-region-marker"))},_dispatchSidePanelMove:function(e){this._setContentWrapper(),this._targetingOverlay.syncOverlays(),this._focusedOverlay.syncFocusedOverlay()},_dispatchStructureInspectorPageClick:function(e){this._formEditor.hideFormEditor(),this._focusedOverlay.hideFocusedOverlay(),this._targetingOverlay.showOverlays(),this._structureInspector.update(null)}}),e.eZ.EditorialInterface=r},"0.2alpha",["event","event-custom","node-screen","node-style","widget","selector-css3","transition","ez-switches"]);