YUI.add("ez-overlay",function(e){"use strict";function i(e){i.superclass.constructor.apply(this,arguments)}e.namespace("eZ");var t=e.Lang,n=1,r="";i.NAME="overlay",i.CSS_PREFIX="ez-ei-"+i.NAME,i.ATTRS={overlayClassName:{value:"ez-ei-overlay"},overlayMarkerClassName:{value:"ez-ei-overlay-marker"}},i.HTML_PARSER={},e.extend(i,e.Widget,{initializer:function(){},destructor:function(){},renderUI:function(){},bindUI:function(){},syncUI:function(){},showOverlays:function(t,i,s){t=typeof t!="undefined"?t:1,i=typeof i!="undefined"?i:"",s=typeof s!="undefined"?s:"";if(t!=n||i!=r)n=t,r=i,this._createOverlays(s),this.syncOverlays();else{var o=e.all("."+this.get("overlayClassName"));o.isEmpty()?(this._createOverlays(s),this.syncOverlays()):o.show()}this.flagVisible=!0},hideOverlays:function(){var t=e.all("."+this.get("overlayClassName"));t.isEmpty()||t.hide(),this.flagVisible=!1},syncOverlays:function(){if(this.flagVisible){var t=e.all("."+this.get("overlayClassName")),n=this;t.isEmpty()||t.each(function(t){var r=e.one("#"+t.getAttribute("data-ez-overlay-target"));n._syncNodes(r,t)})}},_createOverlays:function(t){this._killOverlays();var i="";r&&(i+="#"+r+" "),i+='[data-ez-editable-region="true"][data-ez-editable-region-level='+n+"]";var s=e.all(i),o=this.get("overlayClassName"),u=this.get("overlayMarkerClassName"),a=this.get("srcNode"),f=this;if(!s.isEmpty()){s.each(function(n,r){var i="";t?i=t+"."+(r+1):i+=r+1;var s=e.Node.create(['<div class="',o,'" data-ez-overlay-order="',r+1,'" data-ez-overlay-target="',n.getAttribute("id"),'"></div>'].join("")),l=e.Node.create(['<div class="',u,'">',i,"</div>"].join(""));l.addClass("ez-ei-overlay-marker-blocks");if(n.getAttribute("data-ez-field-type-identifier")=="ezstring"||n.getAttribute("data-ez-field-type-identifier")=="eztext")l.removeClass("ez-ei-overlay-marker-blocks"),l.addClass("ez-ei-overlay-marker-text");n.getAttribute("data-ez-field-type-identifier")=="ezimage"&&(l.removeClass("ez-ei-overlay-marker-blocks"),l.addClass("ez-ei-overlay-marker-image"));if(n.getAttribute("data-ez-field-type-identifier")=="ezselection"||n.getAttribute("data-ez-field-type-identifier")=="ezobjectrelationlist")l.removeClass("ez-ei-overlay-marker-blocks"),l.addClass("ez-ei-overlay-marker-list");s.appendChild(l),n.setAttribute("data-ez-editable-region-marker",i),a.appendChild(s),f._syncNodes(n,s)});var l=e.all("."+this.get("overlayClassName"));a.delegate("click",this._overlayClick,".ez-ei-overlay"),l.on("mouseover",e.bind(this._overlayMouseOver,this)),l.on("mouseout",e.bind(this._overlayMouseOut,this))}},_killOverlays:function(){var t=e.all("."+this.get("overlayClassName"));t.isEmpty()||t.remove(!0)},_syncNodes:function(e,t){var n=e.get("offsetWidth"),r=e.get("offsetHeight"),i=e.getStyle("display"),s=e.getStyle("visibility");i=="inline"&&(i="block"),r<26&&(r=26),t.setStyles({width:n,height:r,display:i,visibility:s}),t.setX(e.getX()),t.setY(e.getY())},_overlayMouseOver:function(e){e.target.hasClass(this.get("overlayClassName"))&&e.target.transition({duration:.2,backgroundColor:"rgba(255, 247, 0, 0.2)"})},_overlayMouseOut:function(e){e.target.hasClass(this.get("overlayClassName"))&&e.target.transition({duration:.2,backgroundColor:"rgba(255, 247, 0, 0.06)"})},_overlayClick:function(t){e.fire("overlay:overlayClicked",{},e.one("#"+this.getAttribute("data-ez-overlay-target")))}}),e.eZ.Overlay=i},"0.2alpha",["widget","event-custom"]);